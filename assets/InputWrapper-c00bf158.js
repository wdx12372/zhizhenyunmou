import{v as M,q as D,x as w,_ as z,g as R,r as u,o as f,c as m,d as t,t as T,s as j,y as A,z as E,A as P}from"./index-fe7843dc.js";const V=M(),b=D(V);async function W(d,p){const n="/api/files/upload";return new Promise(async(o,a)=>{try{const s=new FormData;s.append("file",d),s.append("user",b.getUserId);const c=await w.post(n,s,{headers:{Authorization:"Bearer app-2vWsFF8PM5gJjxnHe5zVGqB1","Content-Type":"multipart/form-data"}});console.log("文件上传成功：",c.data),o(c.data)}catch(s){a(s)}})}async function q(d){const p="/api/audio-to-text";return new Promise(async(n,o)=>{try{const a=new FormData;a.append("file",d),a.append("user",b.getUserId);const s=await w.post(p,a,{headers:{Authorization:"Bearer app-2vWsFF8PM5gJjxnHe5zVGqB1","Content-Type":"multipart/form-data"}});console.log("文件上传成功：",s.data),n(s.data)}catch(a){o(a)}})}const S={class:"input-wrapper animate-in"},L={type:"file",hidden:"",id:"fileInput",ref:"fileInput",accept:"image/png, image/jpeg, image/jpg, image/webp, image/gif, .txt, .xls, .xlsx, .doc, .docx"},N={key:0,class:"fileBox"},G={class:"fileCont"},H=["title"],J={class:"input-box"},K={class:"input-tools"},O=["disabled"],$={__name:"InputWrapper",emits:["send-message"],setup(d,{emit:p}){const n=R.useToast(),o=u(""),a=u(!1),s=u({}),c=u(!1),v=u([]),h=p,y=()=>{o.value.trim()&&(h("send-message",{query:o.value,files:v.value}),o.value="",_())},_=()=>{s.value={},a.value=!1,v.value=[]},k=()=>{const i=document.getElementById("fileInput");i.click(),i.addEventListener("change",async()=>{const e=i.files[0];if(e){s.value=e,a.value=!0;try{const r=await W(e);n.success("上传成功！"),console.log({result:r}),v.value=[{type:r.mime_type,transfer_method:"local_file",upload_file_id:r.id}]}catch(r){n.error("上传失败："+r.message)}}else alert("未选择文件！")})},I=()=>{C()},B=()=>{F()};let l,g=[];async function C(){try{c.value=!0;const i=await navigator.mediaDevices.getUserMedia({audio:!0});l=new MediaRecorder(i),l.ondataavailable=e=>{e.data.size>0&&g.push(e.data)},l.onstop=async()=>{n.success("正在转换为文字...");const e=new Blob(g,{type:"audio/wav"}),r=URL.createObjectURL(e),U=new File([r],Math.random(),{type:"audio/wav"});try{const x=await q(U)}catch(x){n.error("语音转文字出错了，请先使用文字输入吧！"),console.error("语音转文字出错了:",x)}g=[]},l.start()}catch(i){n.error("无法访问麦克风,请在浏览器设置中允许当前域名获取麦克风权限"),c.value=!1,console.error("无法访问麦克风:",i)}}function F(){l&&l.state==="recording"?(l.stop(),c.value=!1,l.stream&&l.stream.getTracks().forEach(e=>{e.kind==="audio"&&e.readyState==="live"&&e.stop()})):console.log("录音未开始或已停止")}return(i,e)=>(f(),m("div",S,[t("input",L,null,512),a.value?(f(),m("div",N,[t("div",G,[t("button",{class:"tool-btn delIcon",onClick:_},e[1]||(e[1]=[t("i",{class:"fas fa-times-circle"},null,-1)])),e[2]||(e[2]=t("i",{class:"fas fa-paperclip"},null,-1)),t("span",{class:"fileName",title:s.value.name},T(s.value.name),9,H)])])):j("",!0),t("div",J,[A(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=r=>o.value=r),placeholder:"输入问题开始对话...",onKeyup:P(y,["enter"])},null,544),[[E,o.value]]),t("div",K,[t("button",{class:"tool-btn",title:"附件",onClick:k},e[3]||(e[3]=[t("i",{class:"fas fa-paperclip"},null,-1)])),c.value?(f(),m("button",{key:1,class:"tool-btn",title:"点击结束",onClick:B},e[5]||(e[5]=[t("i",{class:"fas fa-stop"},null,-1)]))):(f(),m("button",{key:0,class:"tool-btn",title:"点击开始语音输入",onClick:I},e[4]||(e[4]=[t("i",{class:"fas fa-microphone"},null,-1)]))),e[7]||(e[7]=t("div",{class:"divider"},null,-1)),t("button",{class:"send-btn",onClick:y,disabled:!o.value.trim()},e[6]||(e[6]=[t("i",{class:"fas fa-paper-plane"},null,-1)]),8,O)])])]))}},X=z($,[["__scopeId","data-v-98c28501"]]);export{X as I};
