import{_ as h,g as w,h as k,a as T,q as x,i as b,r as S,j as I,n as y,w as N,b as L,o as l,c as r,l as E,d as s,t as g,F as f,m as H,e as p,f as V,p as q,s as B}from"./index-008ee3cd.js";import{I as D}from"./InputWrapper-2606704e.js";const G={name:"GeneralChat",components:{InputWrapper:D},setup(){const v=w.useToast(),e=k(),i=T();x();const a=b(()=>i.getCurrentMessages),d=S(null),_=b(()=>i.getStatus);I(async()=>{const o=e.query.id,n=e.query.message;i.createdEmptyConversation(),o?i.restoreConversation(o)&&y(()=>{c()}):n?n&&(await i.sendMessage(JSON.parse(n),"general"),c()):(console.log("没有对话ID"),i.createdEmptyConversation())});const c=()=>{d.value&&y(()=>{d.value.scrollTop=d.value.scrollHeight})},t=async o=>{await i.sendMessage(o,"general"),c()};return N(()=>i.getMessage,()=>{c()},{deep:!0}),{chatStore:i,status:_,messages:a,sendMessage:t,formatTime:o=>new Date(o).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),copyMessage:async o=>{try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(o),v.success("已复制到剪切板！");else{const n=document.createElement("textarea");return n.value=o,document.body.appendChild(n),n.focus(),n.select(),v.success("已复制到剪切板！"),new Promise((u,C)=>{document.execCommand("copy")?u():C(),n.remove()})}}catch(n){console.error("复制失败:",n),v.error("复制失败："+n)}},shareMessage:o=>{console.log("分享消息:",o)},favoriteMessage:o=>{console.log("收藏消息:",o)},deleteMessage:o=>{const n=a.value.findIndex(u=>u.id===o.id);n!==-1&&a.value.splice(n,1)},messagesContainer:d,switchMode:o=>{router.push({name:o==="tianwen"?"Tianwen":"Strategy",query:{fromChat:!0,lastMessage:inputMessage.value}})}}}},W={class:"chat-container"},z={class:"chat-interface"},F={class:"messages-container",ref:"messagesContainer"},j={class:"message ai"},A={class:"message-wrapper"},J={class:"message-time"},O={class:"message-wrapper"},P=["innerHTML"],R={class:"message-wrapper"},U=["innerHTML"],K={class:"message-footer"},Q={class:"message-time"},X={class:"message-actions"},Y=["onClick"],Z=["onClick"],$={class:"message-wrapper"},ss={class:"message-content"},es=["title"],ts={class:"message-footer"},as={class:"message-time"},os={class:"message-actions"},ns=["onClick"],is=["onClick"],ls={class:"input-section"},rs={class:"mode-selector"};function cs(v,e,i,a,d,_){const c=L("InputWrapper");return l(),r("div",W,[e[14]||(e[14]=E('<div class="header" data-v-36b5f7fa><div class="title-section" data-v-36b5f7fa><div class="icon" data-v-36b5f7fa><i class="fas fa-comments" data-v-36b5f7fa></i></div><span class="title" data-v-36b5f7fa>智能助手</span></div><div class="actions" data-v-36b5f7fa><button class="action-btn" title="收藏" data-v-36b5f7fa><i class="fas fa-star" data-v-36b5f7fa></i><div class="btn-hover-bg" data-v-36b5f7fa></div></button></div></div>',1)),s("div",z,[s("div",F,[s("div",j,[e[3]||(e[3]=s("div",{class:"avatar"},[s("i",{class:"fas fa-robot"})],-1)),s("div",A,[e[2]||(e[2]=s("div",{class:"message-content"},"你好，我是智能助手，请问有什么可以帮你？",-1)),s("div",J,g(a.formatTime(new Date)),1)])]),(l(!0),r(f,null,H(a.messages,(t,M)=>(l(),r("div",{key:t.id,class:q(["message",t.type])},[t.type==="ai"?(l(),r(f,{key:0},[a.status&&a.messages.length-1===M?(l(),r(f,{key:0},[e[5]||(e[5]=s("div",{class:"avatar"},[s("i",{class:"fas fa-robot"})],-1)),s("div",O,[s("div",{class:"message-content",innerHTML:a.chatStore.getMessage},null,8,P),e[4]||(e[4]=s("div",{class:"message-footer"},[s("div",{class:"message-time"})],-1))])],64)):(l(),r(f,{key:1},[e[8]||(e[8]=s("div",{class:"avatar"},[s("i",{class:"fas fa-robot"})],-1)),s("div",R,[s("div",{class:"message-content",innerHTML:t.content},null,8,U),s("div",K,[s("div",Q,g(a.formatTime(t.timestamp)),1),s("div",X,[s("button",{class:"action-icon",onClick:m=>a.copyMessage(t.content),title:"复制"},e[6]||(e[6]=[s("i",{class:"fas fa-copy"},null,-1)]),8,Y),s("button",{class:"action-icon",onClick:m=>a.favoriteMessage(t),title:"收藏"},e[7]||(e[7]=[s("i",{class:"fas fa-star"},null,-1)]),8,Z)])])])],64))],64)):(l(),r(f,{key:1},[s("div",$,[s("div",ss,[t.files&&t.files.length?(l(),r("i",{key:0,class:"fas fa-paperclip",title:t.files&&t.files[0].type},null,8,es)):B("",!0),p(" "+g(t.content),1)]),s("div",ts,[s("div",as,g(a.formatTime(t.timestamp)),1),s("div",os,[s("button",{class:"action-icon",onClick:m=>a.copyMessage(t.content),title:"复制"},e[9]||(e[9]=[s("i",{class:"fas fa-copy"},null,-1)]),8,ns),s("button",{class:"action-icon",onClick:m=>a.deleteMessage(t),title:"删除"},e[10]||(e[10]=[s("i",{class:"fas fa-trash"},null,-1)]),8,is)])])]),e[11]||(e[11]=s("div",{class:"avatar user-avatar"},[s("i",{class:"fas fa-user"})],-1))],64))],2))),128))],512),s("div",ls,[s("div",rs,[s("button",{class:"mode-btn",onClick:e[0]||(e[0]=t=>a.switchMode("tianwen"))},e[12]||(e[12]=[s("i",{class:"fas fa-search-location"},null,-1),p(" 天网追缉 ")])),s("button",{class:"mode-btn",onClick:e[1]||(e[1]=t=>a.switchMode("strategy"))},e[13]||(e[13]=[s("i",{class:"fas fa-book"},null,-1),p(" 侦查谋略 ")]))]),V(c,{onSendMessage:a.sendMessage},null,8,["onSendMessage"])])])])}const ps=h(G,[["render",cs],["__scopeId","data-v-36b5f7fa"]]);export{ps as default};
